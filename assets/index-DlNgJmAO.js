(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class b{constructor(){this.particles=[]}emit(t,e,i){this.particles.push({x:t,y:e,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,life:1,color:i})}update(){for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.x+=e.vx,e.y+=e.vy,e.life-=.02,e.life<=0&&this.particles.splice(t,1)}}draw(t){for(let e of this.particles)t.globalAlpha=e.life,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,3,0,Math.PI*2),t.fill();t.globalAlpha=1}}class T{constructor(t,e){this.x=t,this.y=e,this.angle=0,this.speed=0,this.maxSpeed=8,this.acceleration=.2,this.friction=.05,this.turnSpeed=.06,this.width=20,this.height=40,this.controls={forward:!1,backward:!1,left:!1,right:!1},this.particles=new b,this.setupInputs()}setupInputs(){document.addEventListener("keydown",t=>{switch(t.key){case"ArrowUp":this.controls.forward=!0;break;case"ArrowDown":this.controls.backward=!0;break;case"ArrowLeft":this.controls.left=!0;break;case"ArrowRight":this.controls.right=!0;break}}),document.addEventListener("keyup",t=>{switch(t.key){case"ArrowUp":this.controls.forward=!1;break;case"ArrowDown":this.controls.backward=!1;break;case"ArrowLeft":this.controls.left=!1;break;case"ArrowRight":this.controls.right=!1;break}})}update(){if(this.controls.forward&&(this.speed+=this.acceleration),this.controls.backward&&(this.speed-=this.acceleration),this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed<-this.maxSpeed/2&&(this.speed=-this.maxSpeed/2),this.speed>0?this.speed-=this.friction:this.speed<0&&(this.speed+=this.friction),Math.abs(this.speed)<this.friction&&(this.speed=0),this.speed!==0){const t=this.speed>0?1:-1;this.controls.left&&(this.angle+=this.turnSpeed*t),this.controls.right&&(this.angle-=this.turnSpeed*t)}this.x-=Math.sin(this.angle)*this.speed,this.y-=Math.cos(this.angle)*this.speed,Math.abs(this.speed)>2&&(this.controls.left||this.controls.right)&&this.particles.emit(this.x,this.y,"rgba(100, 100, 100, 0.5)"),this.particles.update()}draw(t){this.particles.draw(t),t.save(),t.translate(this.x,this.y),t.rotate(-this.angle),t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.ellipse(0,0,13,28,0,0,Math.PI*2),t.fill(),t.strokeStyle="#111",t.lineWidth=2,t.beginPath(),t.moveTo(0,-12),t.lineTo(-12,-20),t.stroke(),t.beginPath(),t.moveTo(0,-12),t.lineTo(12,-20),t.stroke(),t.beginPath(),t.moveTo(0,8),t.lineTo(-12,12),t.stroke(),t.beginPath(),t.moveTo(0,8),t.lineTo(12,12),t.stroke(),t.fillStyle="#1a1a1a",t.beginPath(),t.moveTo(-9,-8),t.lineTo(9,-8),t.lineTo(9,18),t.lineTo(-9,18),t.fill();const e=t.createLinearGradient(-6,0,6,0);e.addColorStop(0,"#D32F2F"),e.addColorStop(.3,"#D32F2F"),e.addColorStop(.35,"#FFFFFF"),e.addColorStop(.65,"#FFFFFF"),e.addColorStop(.7,"#D32F2F"),e.addColorStop(1,"#D32F2F"),t.fillStyle=e,t.beginPath(),t.moveTo(0,-24),t.lineTo(3,-15),t.lineTo(4,-5),t.lineTo(9,0),t.lineTo(9,12),t.lineTo(5,18),t.lineTo(-5,18),t.lineTo(-9,12),t.lineTo(-9,0),t.lineTo(-4,-5),t.lineTo(-3,-15),t.closePath(),t.fill(),t.fillStyle="#B71C1C",t.beginPath(),t.moveTo(-9,2),t.lineTo(-5,2),t.lineTo(-5,10),t.lineTo(-8,8),t.fill(),t.beginPath(),t.moveTo(9,2),t.lineTo(5,2),t.lineTo(5,10),t.lineTo(8,8),t.fill(),t.fillStyle="#111",t.beginPath(),t.ellipse(0,-2,3.5,6,0,0,Math.PI*2),t.fill(),t.fillStyle="#FFFFFF",t.beginPath(),t.arc(0,-2,2.8,0,Math.PI*2),t.fill(),t.fillStyle="#D32F2F",t.beginPath(),t.arc(0,-2,2.8,-Math.PI/4,Math.PI/4),t.fill(),t.strokeStyle="#111",t.lineWidth=2,t.beginPath(),t.arc(0,-2,5,Math.PI,0),t.stroke(),t.beginPath(),t.moveTo(0,-7),t.lineTo(0,-4),t.stroke(),t.fillStyle="#212121",t.beginPath(),t.moveTo(0,-24),t.lineTo(14,-20),t.lineTo(14,-16),t.lineTo(2,-21),t.lineTo(-2,-21),t.lineTo(-14,-16),t.lineTo(-14,-20),t.closePath(),t.fill(),t.fillStyle="#D32F2F",t.fillRect(-14,-19,6,2),t.fillRect(8,-19,6,2),t.fillStyle="#111",t.beginPath(),t.roundRect(-12,16,24,6,1),t.fill(),t.fillStyle="#D32F2F",t.fillRect(-12,16,2,6),t.fillRect(10,16,2,6),t.fillStyle="#FFFFFF",t.fillRect(-10,17,20,2),t.fillStyle="#1a1a1a";const i=(s,o)=>{t.save(),t.translate(s,o),t.fillStyle="#1a1a1a",t.beginPath(),t.roundRect(-4,-6,8,12,2),t.fill(),t.fillStyle="rgba(255, 255, 255, 0.1)",t.fillRect(-2,-6,2,12),t.fillStyle="#FFEB3B",t.fillRect(-4,-2,1,4),t.fillRect(3,-2,1,4),t.restore()};i(-15,-20),i(15,-20),i(-15,12),i(15,12),t.restore()}getCorners(){const t=[],e=Math.cos(this.angle),i=Math.sin(this.angle),s=this.width/2,o=this.height/2;return t.push({x:this.x-i*-o-e*-s,y:this.y-e*-o+i*-s}),t.push({x:this.x-i*-o-e*s,y:this.y-e*-o+i*s}),t.push({x:this.x-i*o-e*-s,y:this.y-e*o+i*-s}),t.push({x:this.x-i*o-e*s,y:this.y-e*o+i*s}),t}}class k{constructor(){this.points=[],this.width=100,this.generate()}generate(){this.points=[];const t=20,e=400,i=3e3,s=3e3,o=[];for(let r=0;r<t;r++)o.push({x:Math.random()*(i-e*2)+e,y:Math.random()*(s-e*2)+e});let n=this.convexHull(o),a=this.perturb(n);this.points=this.smoothTrack(a,5)}perturb(t){const e=[],i=this.getCentroid(t);for(let s=0;s<t.length;s++){const o=t[s],n=t[(s+1)%t.length];e.push(o);const a=Math.hypot(n.x-o.x,n.y-o.y);if(a>300){const r=(o.x+n.x)/2,h=(o.y+n.y)/2,l=i.x-r,d=i.y-h,u=Math.hypot(l,d),p=l/u,c=d/u,m=Math.random()>.3,g=(Math.random()*.6+.2)*a*.5,y=m?1:-.5;e.push({x:r+p*g*y,y:h+c*g*y})}}return e}getCentroid(t){let e=0,i=0;for(let s of t)e+=s.x,i+=s.y;return{x:e/t.length,y:i/t.length}}convexHull(t){t.sort((o,n)=>o.x-n.x);const e=(o,n,a)=>(n.x-o.x)*(a.y-o.y)-(n.y-o.y)*(a.x-o.x),i=[];for(let o of t){for(;i.length>=2&&e(i[i.length-2],i[i.length-1],o)<=0;)i.pop();i.push(o)}const s=[];for(let o=t.length-1;o>=0;o--){const n=t[o];for(;s.length>=2&&e(s[s.length-2],s[s.length-1],n)<=0;)s.pop();s.push(n)}return s.pop(),i.pop(),i.concat(s)}smoothTrack(t,e=3){let i=t;for(let s=0;s<e;s++){const o=[];for(let n=0;n<i.length;n++){const a=i[(n-1+i.length)%i.length],r=i[n],h=i[(n+1)%i.length];o.push({x:r.x*.5+a.x*.25+h.x*.25,y:r.y*.5+a.y*.25+h.y*.25}),s<2&&o.push({x:(r.x+h.x)/2,y:(r.y+h.y)/2})}i=o}return i}draw(t){if(t.beginPath(),t.lineWidth=this.width,t.lineCap="round",t.lineJoin="round",this.asphaltPattern||(this.asphaltPattern=this.createNoisePattern(t)),t.strokeStyle=this.asphaltPattern,this.points.length>0){t.moveTo(this.points[0].x,this.points[0].y);for(let e=1;e<this.points.length;e++)t.lineTo(this.points[e].x,this.points[e].y);t.closePath(),t.stroke()}if(t.lineWidth=this.width+10,t.strokeStyle="white",t.stroke(),t.lineWidth=this.width-10,t.strokeStyle=this.asphaltPattern,t.stroke(),t.beginPath(),t.lineWidth=2,t.strokeStyle="rgba(255, 255, 255, 0.5)",t.setLineDash([20,20]),this.points.length>0){t.moveTo(this.points[0].x,this.points[0].y);for(let e=1;e<this.points.length;e++)t.lineTo(this.points[e].x,this.points[e].y);t.closePath(),t.stroke()}if(t.setLineDash([]),this.points.length>1){const e=this.points[0],i=this.points[1],s=i.x-e.x,o=i.y-e.y,n=Math.atan2(o,s);t.save(),t.translate(e.x,e.y),t.rotate(n);const a=2,r=10,h=this.width/r;t.fillStyle="white",t.fillRect(0,-this.width/2,h*2,this.width),t.fillStyle="black";for(let l=0;l<r;l++)for(let d=0;d<a;d++)(l+d)%2===0&&t.fillRect(d*h,-this.width/2+l*h,h,h);t.restore()}}createNoisePattern(t){const e=document.createElement("canvas");e.width=100,e.height=100;const i=e.getContext("2d");i.fillStyle="#333",i.fillRect(0,0,100,100);for(let s=0;s<500;s++)i.fillStyle=`rgba(255, 255, 255, ${Math.random()*.1})`,i.fillRect(Math.random()*100,Math.random()*100,2,2),i.fillStyle=`rgba(0, 0, 0, ${Math.random()*.1})`,i.fillRect(Math.random()*100,Math.random()*100,2,2);return t.createPattern(e,"repeat")}isPointOnTrack(t,e){const i=this.width/2;for(let s=0;s<this.points.length;s++){const o=this.points[s],n=this.points[(s+1)%this.points.length];if(this.distanceToSegment(t,e,o.x,o.y,n.x,n.y)<=i)return!0}return!1}distanceToSegment(t,e,i,s,o,n){const a=t-i,r=e-s,h=o-i,l=n-s,d=a*h+r*l,u=h*h+l*l;let p=-1;u!==0&&(p=d/u);let c,m;p<0?(c=i,m=s):p>1?(c=o,m=n):(c=i+p*h,m=s+p*l);const g=t-c,y=e-m;return Math.sqrt(g*g+y*y)}}class P{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.width=t.width,this.height=t.height,this.track=new k,this.car=new T(this.track.points[0].x,this.track.points[0].y),this.currentCheckpoint=0,this.raceStarted=!1,this.lapStartTime=0,this.lastLapTime=0,this.bestLapTime=0,this.lastTime=0,this.gameOver=!1,this.paused=!1,this.shake=0,window.addEventListener("keydown",e=>{(e.key==="r"||e.key==="R")&&this.gameOver&&this.restart(!1),(e.key==="n"||e.key==="N")&&(this.gameOver&&this.restart(!0),this.paused&&(this.togglePause(),this.restart(!0))),e.key==="Escape"&&(this.gameOver||this.togglePause())}),this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}update(t){this.car.update(),!this.raceStarted&&(this.car.speed!==0||this.car.controls.forward)&&(this.raceStarted=!0,this.lapStartTime=performance.now()),this.shake>0&&(this.shake-=.2,this.shake<0&&(this.shake=0));const e=this.car.getCorners();let i=0;for(let s of e)this.track.isPointOnTrack(s.x,s.y)||(i++,Math.abs(this.car.speed)>1&&this.car.particles.emit(s.x,s.y,"rgba(60, 40, 20, 0.8)"));i>0&&(this.shake=Math.min(this.shake+.8,5))}draw(){this.ctx.fillStyle="green",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.save();const t=(Math.random()-.5)*this.shake,e=(Math.random()-.5)*this.shake;this.ctx.translate(this.width/2-this.car.x+t,this.height/2-this.car.y+e),this.track.draw(this.ctx),this.car.draw(this.ctx),this.ctx.restore()}togglePause(){this.paused=!this.paused;const t=document.getElementById("pause-menu");if(this.paused){t.classList.remove("hidden"),this.pauseStartTime=performance.now();let e="0.000";this.raceStarted&&(e=((performance.now()-this.lapStartTime)/1e3).toFixed(3)),document.getElementById("pause-current").textContent=e,document.getElementById("pause-last").textContent=this.lastLapTime.toFixed(3),document.getElementById("pause-best").textContent=this.bestLapTime.toFixed(3)}else{t.classList.add("hidden");const e=performance.now()-this.pauseStartTime;this.raceStarted&&(this.lapStartTime+=e),this.lastTime=performance.now()}}loop(t){if(this.paused){requestAnimationFrame(this.loop);return}const e=t-this.lastTime;this.lastTime=t,this.update(e),this.checkTrackLimits(),this.checkCheckpoints(),this.draw(),this.updateHUD(),requestAnimationFrame(this.loop)}checkCheckpoints(){if(this.gameOver||!this.raceStarted)return;const t=(this.currentCheckpoint+1)%this.track.points.length,e=this.track.points[t];Math.hypot(this.car.x-e.x,this.car.y-e.y)<this.track.width*1.5&&(this.currentCheckpoint=t,this.currentCheckpoint===0&&this.completeLap())}completeLap(){const t=performance.now(),e=(t-this.lapStartTime)/1e3;this.lastLapTime=e,(this.bestLapTime===0||e<this.bestLapTime)&&(this.bestLapTime=e),this.lapStartTime=t}updateHUD(){const t=Math.abs(this.car.speed)/this.car.maxSpeed*375;document.getElementById("speed-value").textContent=t.toFixed(0);let e="0.000";this.raceStarted&&(e=((performance.now()-this.lapStartTime)/1e3).toFixed(3)),document.getElementById("current-time").textContent=e,this.lastLapTime>0&&(document.getElementById("last-time").textContent=this.lastLapTime.toFixed(3)),this.bestLapTime>0&&(document.getElementById("best-time").textContent=this.bestLapTime.toFixed(3));const i=document.getElementById("game-over");this.gameOver?i.classList.remove("hidden"):i.classList.add("hidden")}checkTrackLimits(){if(this.gameOver)return;const t=this.car.getCorners();let e=0;for(let i of t)this.track.isPointOnTrack(i.x,i.y)||e++;e===4&&(this.gameOver=!0)}restart(t=!1){t&&(this.track=new k,this.bestLapTime=0,this.lastLapTime=0,document.getElementById("best-time").textContent="0.000",document.getElementById("last-time").textContent="0.000"),this.car=new T(this.track.points[0].x,this.track.points[0].y),this.gameOver=!1,this.raceStarted=!1,this.currentCheckpoint=0,this.lapStartTime=0,this.lastTime=performance.now()}}document.querySelector("#app").innerHTML=`
  <canvas id="gameCanvas"></canvas>
`;const f=document.querySelector("#gameCanvas");f.width=window.innerWidth;f.height=window.innerHeight;const S=new P(f);window.addEventListener("resize",()=>{f.width=window.innerWidth,f.height=window.innerHeight,S.width=f.width,S.height=f.height});
